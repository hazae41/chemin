{"version":3,"file":"index.mjs","sources":["../../../../src/mods/paths/index.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { Nullable, Option } from \"@hazae41/option\"\nimport { CloseContext } from \"@hazae41/react-close-context\"\nimport { ChildrenProps, Setter, State } from \"libs/react/index.js\"\nimport { hashAsUrl, pathOf, searchAsUrl, urlOf } from \"libs/url/index.js\"\nimport { createContext, KeyboardEvent, MouseEvent, SetStateAction, useCallback, useContext, useEffect, useMemo, useRef, useState } from \"react\"\n\ndeclare const navigation: Nullable<any>\n\nexport interface PathHandle {\n  /**\n   * The current relative URL\n   */\n  readonly url: URL\n\n  /**\n   * The pending relative URL\n   */\n  get(): URL\n\n  /**\n   * Get the absolute URL if we would go to the given relative URL\n   * @param hrefOrUrl\n   */\n  go(hrefOrUrl: string | URL): URL\n}\n\nexport interface ValueHandle {\n  /**\n   * The current value\n   */\n  readonly value: Nullable<string>\n\n  /**\n   * The pending value\n   */\n  get(): Nullable<string>\n\n  /**\n   * Get the absolute URL if we would set the value to the given value\n   * @param hrefOrUrl\n   */\n  set(value: Nullable<string>): URL\n}\n\nexport const PathContext =\n  createContext<Nullable<PathHandle>>(undefined)\n\nexport function usePathContext() {\n  return Option.wrap(useContext(PathContext))\n}\n\n/**\n * Root-based path provider using the modern Navigation API\n * @param props \n * @returns \n */\nexport function RootPathProvider(props: ChildrenProps) {\n  const { children } = props\n\n  const [raw, setRaw] = useState<string>()\n\n  useEffect(() => {\n    const onCurrentEntryChange = () => setRaw(location.href)\n\n    navigation?.addEventListener(\"currententrychange\", onCurrentEntryChange, { passive: true })\n    return () => navigation?.removeEventListener(\"currententrychange\", onCurrentEntryChange)\n  }, [])\n\n  const get = useCallback(() => {\n    return new URL(location.href)\n  }, [raw])\n\n  const url = useMemo(() => {\n    return get()\n  }, [get])\n\n  const go = useCallback((hrefOrUrl: string | URL) => {\n    return new URL(hrefOrUrl, location.href)\n  }, [])\n\n  const handle = useMemo(() => {\n    return { url, get, go } satisfies PathHandle\n  }, [url, get, go])\n\n  return <PathContext.Provider value={handle}>\n    {children}\n  </PathContext.Provider>\n}\n\n/**\n * Hash-based subpath provider using the legacy `hashchange`\n * @param props \n * @returns \n */\nexport function HashPathProvider(props: ChildrenProps) {\n  const { children } = props\n\n  const [raw, setRaw] = useState<string>()\n\n  useEffect(() => {\n    const onHashChange = () => setRaw(location.href)\n\n    addEventListener(\"hashchange\", onHashChange, { passive: true })\n    return () => removeEventListener(\"hashchange\", onHashChange)\n  }, [])\n\n  const get = useCallback(() => {\n    return hashAsUrl(location.href)\n  }, [raw])\n\n  const url = useMemo(() => {\n    return get()\n  }, [get])\n\n  const go = useCallback((hrefOrUrl: string | URL) => {\n    const url = new URL(location.href)\n    url.hash = `#${pathOf(hrefOrUrl)}`\n    return url\n  }, [])\n\n  const handle = useMemo(() => {\n    return { url, get, go } satisfies PathHandle\n  }, [url, get, go])\n\n  return <PathContext.Provider value={handle}>\n    {children}\n  </PathContext.Provider>\n}\n\n/**\n * Get a hash-based subpath from the given path\n * @param path \n * @returns \n */\nexport function useHashSubpath(path: PathHandle): PathHandle {\n  const get = useCallback(() => {\n    return hashAsUrl(path.get())\n  }, [path])\n\n  const url = useMemo(() => {\n    return get()\n  }, [get])\n\n  const go = useCallback((hrefOrUrl: string | URL) => {\n    const url = path.get()\n    url.hash = `#${pathOf(hrefOrUrl)}`\n    return path.go(url)\n  }, [path])\n\n  return useMemo(() => {\n    return { url, get, go } satisfies PathHandle\n  }, [url, get, go])\n}\n\n/**\n * Provide a hash-based subpath from the current path along with a close context\n * @param props \n * @returns \n */\nexport function HashSubpathProvider(props: ChildrenProps) {\n  const { children } = props\n\n  const path = usePathContext().getOrThrow()\n  const hash = useHashSubpath(path)\n\n  const onClose = useCallback(() => {\n    location.replace(hash.go(\"/\"))\n  }, [hash])\n\n  return <PathContext.Provider value={hash}>\n    <CloseContext.Provider value={onClose}>\n      {children}\n    </CloseContext.Provider>\n  </PathContext.Provider>\n}\n\n/**\n * Get a search-based subpath from the given path\n * @param path \n * @param key \n * @returns \n */\nexport function useSearchSubpath(path: PathHandle, key: string): PathHandle {\n  const get = useCallback(() => {\n    return searchAsUrl(path.get(), key)\n  }, [key, path])\n\n  const url = useMemo(() => {\n    return get()\n  }, [get])\n\n  const go = useCallback((hrefOrUrl: string) => {\n    const url = path.get()\n    url.searchParams.set(key, pathOf(hrefOrUrl))\n    return path.go(url)\n  }, [key, path])\n\n  return useMemo(() => {\n    return { url, get, go } satisfies PathHandle\n  }, [url, get, go])\n}\n\n/**\n * Get a search-based value from the given path\n * @param path \n * @param key \n * @returns \n */\nexport function useSearchValue(path: PathHandle, key: string) {\n  const get = useCallback(() => {\n    return path.get().searchParams.get(key)\n  }, [key, path])\n\n  const value = useMemo(() => {\n    return get()\n  }, [get])\n\n  const set = useCallback((value: Nullable<string>) => {\n    const url = path.get()\n\n    if (value == null)\n      url.searchParams.delete(key)\n    else\n      url.searchParams.set(key, value)\n\n    return path.go(url)\n  }, [key, path])\n\n  return useMemo(() => {\n    return { value, get, set } satisfies ValueHandle\n  }, [value, get, set])\n}\n\n/**\n * Get a search-based state from the given path\n * @param path \n * @param key \n * @returns \n */\nexport function useSearchState(path: PathHandle, key: string) {\n  const state = useMemo(() => {\n    return path.get().searchParams.get(key)\n  }, [path, key])\n\n  const setStateRef = useRef<Setter<Nullable<string>>>()\n\n  setStateRef.current = useCallback((action: SetStateAction<Nullable<string>>) => {\n    const url = path.get()\n\n    const prev = url.searchParams.get(key)\n\n    const next = typeof action === \"function\"\n      ? action(prev)\n      : action\n\n    if (next == null)\n      url.searchParams.delete(key)\n    else\n      url.searchParams.set(key, next)\n\n    location.replace(path.go(url))\n  }, [key, path])\n\n  const setState = useCallback((action: SetStateAction<Nullable<string>>) => {\n    setStateRef.current?.(action)\n  }, [])\n\n  return [state, setState] satisfies State<Nullable<string>>\n}\n\n/**\n * Provide a search-based subpath from the current path along with a close context\n * @param props \n * @returns \n */\nexport function SearchSubpathProvider(props: ChildrenProps & { readonly value: string }) {\n  const { children, value } = props\n\n  const path = usePathContext().getOrThrow()\n  const search = useSearchSubpath(path, value)\n\n  const onClose = useCallback(() => {\n    location.replace(search.go(\"/\"))\n  }, [search])\n\n  return <PathContext.Provider value={search}>\n    <CloseContext.Provider value={onClose}>\n      {children}\n    </CloseContext.Provider>\n  </PathContext.Provider>\n}\n\n/**\n * Pass the coordinates of the events to the given URL and replace-navigate to it relative to the given path\n * @param path \n * @param hrefOrUrl \n * @returns \n */\nexport function useCoords(path: PathHandle, hrefOrUrl: Nullable<string | URL>) {\n  const href = useMemo(() => {\n    if (hrefOrUrl == null)\n      return\n    return path.go(hrefOrUrl).href\n  }, [hrefOrUrl, path])\n\n  const onClick = useCallback((e: MouseEvent) => {\n    if (e.button !== 0)\n      return\n    if (hrefOrUrl == null)\n      return\n\n    e.preventDefault()\n\n    const x = e.clientX\n    const y = e.clientY\n\n    location.replace(path.go(urlOf(hrefOrUrl, { x, y })))\n  }, [hrefOrUrl, path])\n\n  const onKeyDown = useCallback((e: KeyboardEvent) => {\n    if (e.key !== \"Enter\")\n      return\n    if (hrefOrUrl == null)\n      return\n\n    e.preventDefault()\n\n    const x = e.currentTarget.getBoundingClientRect().x + (e.currentTarget.getBoundingClientRect().width / 2)\n    const y = e.currentTarget.getBoundingClientRect().y + (e.currentTarget.getBoundingClientRect().height / 2)\n\n    location.replace(path.go(urlOf(hrefOrUrl, { x, y })))\n  }, [hrefOrUrl, path])\n\n  const onContextMenu = useCallback((e: MouseEvent) => {\n    if (hrefOrUrl == null)\n      return\n\n    e.preventDefault()\n\n    const x = e.clientX\n    const y = e.clientY\n\n    location.replace(path.go(urlOf(hrefOrUrl, { x, y })))\n  }, [hrefOrUrl, path])\n\n  return { onClick, onKeyDown, onContextMenu, href }\n}"],"names":["PathContext","createContext","undefined","usePathContext","Option","wrap","useContext","RootPathProvider","props","children","raw","setRaw","useState","useEffect","onCurrentEntryChange","location","href","navigation","addEventListener","passive","removeEventListener","get","useCallback","URL","url","useMemo","go","hrefOrUrl","handle","Provider","value","HashPathProvider","onHashChange","hashAsUrl","hash","pathOf","useHashSubpath","path","HashSubpathProvider","getOrThrow","onClose","replace","CloseContext","useSearchSubpath","key","searchAsUrl","searchParams","set","useSearchValue","delete","useSearchState","state","setStateRef","useRef","current","action","prev","next","setState","SearchSubpathProvider","search","useCoords","onClick","e","button","preventDefault","x","clientX","y","clientY","urlOf","onKeyDown","currentTarget","getBoundingClientRect","width","height","onContextMenu"],"mappings":"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"}