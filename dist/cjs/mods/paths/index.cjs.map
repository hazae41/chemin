{"version":3,"file":"index.cjs","sources":["../../../../src/mods/paths/index.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { Nullable, Option } from \"@hazae41/option\"\nimport { CloseContext } from \"@hazae41/react-close-context\"\nimport { ChildrenProps, Setter, State } from \"libs/react/index.js\"\nimport { hashAsUrl, pathOf, searchAsUrl, urlOf } from \"libs/url/index.js\"\nimport { createContext, KeyboardEvent, MouseEvent, SetStateAction, useCallback, useContext, useEffect, useMemo, useRef, useState } from \"react\"\n\ndeclare const navigation: Nullable<any>\n\nexport interface PathHandle {\n  /**\n   * The current relative URL\n   */\n  readonly url: URL\n\n  /**\n   * The pending relative URL\n   */\n  get(): URL\n\n  /**\n   * Get the absolute URL if we would go to the given relative URL\n   * @param hrefOrUrl\n   */\n  go(hrefOrUrl: string | URL): URL\n}\n\nexport interface ValueHandle {\n  /**\n   * The current value\n   */\n  readonly value: Nullable<string>\n\n  /**\n   * The pending value\n   */\n  get(): Nullable<string>\n\n  /**\n   * Get the absolute URL if we would set the value to the given value\n   * @param hrefOrUrl\n   */\n  set(value: Nullable<string>): URL\n}\n\nexport const PathContext =\n  createContext<Nullable<PathHandle>>(undefined)\n\nexport function usePathContext() {\n  return Option.wrap(useContext(PathContext))\n}\n\n/**\n * Root-based path provider using the modern Navigation API\n * @param props \n * @returns \n */\nexport function RootPathProvider(props: ChildrenProps) {\n  const { children } = props\n\n  const [raw, setRaw] = useState<string>()\n\n  useEffect(() => {\n    const onCurrentEntryChange = () => setRaw(location.href)\n\n    navigation?.addEventListener(\"currententrychange\", onCurrentEntryChange, { passive: true })\n    return () => navigation?.removeEventListener(\"currententrychange\", onCurrentEntryChange)\n  }, [])\n\n  const get = useCallback(() => {\n    return new URL(location.href)\n  }, [raw])\n\n  const url = useMemo(() => {\n    return get()\n  }, [get])\n\n  const go = useCallback((hrefOrUrl: string | URL) => {\n    return new URL(hrefOrUrl, location.href)\n  }, [])\n\n  const handle = useMemo(() => {\n    return { url, get, go } satisfies PathHandle\n  }, [url, get, go])\n\n  return <PathContext.Provider value={handle}>\n    {children}\n  </PathContext.Provider>\n}\n\n/**\n * Hash-based subpath provider using the legacy `hashchange`\n * @param props \n * @returns \n */\nexport function HashPathProvider(props: ChildrenProps) {\n  const { children } = props\n\n  const [raw, setRaw] = useState<string>()\n\n  useEffect(() => {\n    const onHashChange = () => setRaw(location.href)\n\n    addEventListener(\"hashchange\", onHashChange, { passive: true })\n    return () => removeEventListener(\"hashchange\", onHashChange)\n  }, [])\n\n  const get = useCallback(() => {\n    return hashAsUrl(location.href)\n  }, [raw])\n\n  const url = useMemo(() => {\n    return get()\n  }, [get])\n\n  const go = useCallback((hrefOrUrl: string | URL) => {\n    const url = new URL(location.href)\n    url.hash = `#${pathOf(hrefOrUrl)}`\n    return url\n  }, [])\n\n  const handle = useMemo(() => {\n    return { url, get, go } satisfies PathHandle\n  }, [url, get, go])\n\n  return <PathContext.Provider value={handle}>\n    {children}\n  </PathContext.Provider>\n}\n\n/**\n * Get a hash-based subpath from the given path\n * @param path \n * @returns \n */\nexport function useHashSubpath(path: PathHandle): PathHandle {\n  const get = useCallback(() => {\n    return hashAsUrl(path.get())\n  }, [path])\n\n  const url = useMemo(() => {\n    return get()\n  }, [get])\n\n  const go = useCallback((hrefOrUrl: string | URL) => {\n    const url = path.get()\n    url.hash = `#${pathOf(hrefOrUrl)}`\n    return path.go(url)\n  }, [path])\n\n  return useMemo(() => {\n    return { url, get, go } satisfies PathHandle\n  }, [url, get, go])\n}\n\n/**\n * Provide a hash-based subpath from the current path along with a close context\n * @param props \n * @returns \n */\nexport function HashSubpathProvider(props: ChildrenProps) {\n  const { children } = props\n\n  const path = usePathContext().getOrThrow()\n  const hash = useHashSubpath(path)\n\n  const onClose = useCallback(() => {\n    location.replace(hash.go(\"/\"))\n  }, [hash])\n\n  return <PathContext.Provider value={hash}>\n    <CloseContext.Provider value={onClose}>\n      {children}\n    </CloseContext.Provider>\n  </PathContext.Provider>\n}\n\n/**\n * Get a search-based subpath from the given path\n * @param path \n * @param key \n * @returns \n */\nexport function useSearchSubpath(path: PathHandle, key: string): PathHandle {\n  const get = useCallback(() => {\n    return searchAsUrl(path.get(), key)\n  }, [key, path])\n\n  const url = useMemo(() => {\n    return get()\n  }, [get])\n\n  const go = useCallback((hrefOrUrl: string) => {\n    const url = path.get()\n    url.searchParams.set(key, pathOf(hrefOrUrl))\n    return path.go(url)\n  }, [key, path])\n\n  return useMemo(() => {\n    return { url, get, go } satisfies PathHandle\n  }, [url, get, go])\n}\n\n/**\n * Get a search-based value from the given path\n * @param path \n * @param key \n * @returns \n */\nexport function useSearchValue(path: PathHandle, key: string) {\n  const get = useCallback(() => {\n    return path.get().searchParams.get(key)\n  }, [key, path])\n\n  const value = useMemo(() => {\n    return get()\n  }, [get])\n\n  const set = useCallback((value: Nullable<string>) => {\n    const url = path.get()\n\n    if (value == null)\n      url.searchParams.delete(key)\n    else\n      url.searchParams.set(key, value)\n\n    return path.go(url)\n  }, [key, path])\n\n  return useMemo(() => {\n    return { value, get, set } satisfies ValueHandle\n  }, [value, get, set])\n}\n\n/**\n * Get a search-based state from the given path\n * @param path \n * @param key \n * @returns \n */\nexport function useSearchState(path: PathHandle, key: string) {\n  const state = useMemo(() => {\n    return path.get().searchParams.get(key)\n  }, [path, key])\n\n  const setStateRef = useRef<Setter<Nullable<string>>>()\n\n  setStateRef.current = useCallback((action: SetStateAction<Nullable<string>>) => {\n    const url = path.get()\n\n    const prev = url.searchParams.get(key)\n\n    const next = typeof action === \"function\"\n      ? action(prev)\n      : action\n\n    if (next == null)\n      url.searchParams.delete(key)\n    else\n      url.searchParams.set(key, next)\n\n    location.replace(path.go(url))\n  }, [key, path])\n\n  const setState = useCallback((action: SetStateAction<Nullable<string>>) => {\n    setStateRef.current?.(action)\n  }, [])\n\n  return [state, setState] satisfies State<Nullable<string>>\n}\n\n/**\n * Provide a search-based subpath from the current path along with a close context\n * @param props \n * @returns \n */\nexport function SearchSubpathProvider(props: ChildrenProps & { readonly value: string }) {\n  const { children, value } = props\n\n  const path = usePathContext().getOrThrow()\n  const search = useSearchSubpath(path, value)\n\n  const onClose = useCallback(() => {\n    location.replace(search.go(\"/\"))\n  }, [search])\n\n  return <PathContext.Provider value={search}>\n    <CloseContext.Provider value={onClose}>\n      {children}\n    </CloseContext.Provider>\n  </PathContext.Provider>\n}\n\n/**\n * Pass the coordinates of the events to the given URL and replace-navigate to it relative to the given path\n * @param path \n * @param hrefOrUrl \n * @returns \n */\nexport function useCoords(path: PathHandle, hrefOrUrl: Nullable<string | URL>) {\n  const href = useMemo(() => {\n    if (hrefOrUrl == null)\n      return\n    return path.go(hrefOrUrl).href\n  }, [hrefOrUrl, path])\n\n  const onClick = useCallback((e: MouseEvent) => {\n    if (e.button !== 0)\n      return\n    if (hrefOrUrl == null)\n      return\n\n    e.preventDefault()\n\n    const x = e.clientX\n    const y = e.clientY\n\n    location.replace(path.go(urlOf(hrefOrUrl, { x, y })))\n  }, [hrefOrUrl, path])\n\n  const onKeyDown = useCallback((e: KeyboardEvent) => {\n    if (e.key !== \"Enter\")\n      return\n    if (hrefOrUrl == null)\n      return\n\n    e.preventDefault()\n\n    const x = e.currentTarget.getBoundingClientRect().x + (e.currentTarget.getBoundingClientRect().width / 2)\n    const y = e.currentTarget.getBoundingClientRect().y + (e.currentTarget.getBoundingClientRect().height / 2)\n\n    location.replace(path.go(urlOf(hrefOrUrl, { x, y })))\n  }, [hrefOrUrl, path])\n\n  const onContextMenu = useCallback((e: MouseEvent) => {\n    if (hrefOrUrl == null)\n      return\n\n    e.preventDefault()\n\n    const x = e.clientX\n    const y = e.clientY\n\n    location.replace(path.go(urlOf(hrefOrUrl, { x, y })))\n  }, [hrefOrUrl, path])\n\n  return { onClick, onKeyDown, onContextMenu, href }\n}"],"names":["PathContext","createContext","undefined","usePathContext","Option","wrap","useContext","RootPathProvider","props","children","raw","setRaw","useState","useEffect","onCurrentEntryChange","location","href","navigation","addEventListener","passive","removeEventListener","get","useCallback","URL","url","useMemo","go","hrefOrUrl","handle","React","Provider","value","HashPathProvider","onHashChange","hashAsUrl","hash","pathOf","useHashSubpath","path","HashSubpathProvider","getOrThrow","onClose","replace","CloseContext","useSearchSubpath","key","searchAsUrl","searchParams","set","useSearchValue","delete","useSearchState","state","setStateRef","useRef","current","action","prev","next","setState","SearchSubpathProvider","search","useCoords","onClick","e","button","preventDefault","x","clientX","y","clientY","urlOf","onKeyDown","currentTarget","getBoundingClientRect","width","height","onContextMenu"],"mappings":"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"}